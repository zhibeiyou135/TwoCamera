# 递归播放功能使用说明

## 功能介绍

递归播放功能允许用户选择一个主目录，系统会自动递归搜索所有子目录中的会话数据，并按顺序播放每个会话的DV和DVS数据，同时将数据送入检测模块进行实时检测。

## 界面说明（简化版）

在主窗口中的播放控制区域包含：

1. **递归播放区域**：
   - "递归播放:" 标签
   - 主目录路径显示框（显示选择的主目录路径）
   - "选择主目录递归播放" 按钮
   - 播放状态显示框（显示当前播放状态和进度）

**注意**：为了简化界面，已移除了单独的文件播放控件，现在只保留递归播放功能。

## 使用步骤

### 1. 准备数据目录结构

确保你的数据按以下结构组织：

```
主目录/
├── x1_2025-07-09_13-26-07_01/
│   ├── dv_original/          # DV图像文件夹
│   │   ├── 1625123456789.jpg
│   │   ├── 1625123456790.jpg
│   │   └── ...
│   └── dvs_raw/              # DVS数据文件夹
│       └── data.raw          # 或 data.bin
├── x1_2025-07-09_13-26-07_02/
│   ├── dv_original/
│   └── dvs_images/           # 也支持dvs_images文件夹
│       └── data.bin
└── 其他子目录/
    └── x1_2025-07-09_13-26-07_03/
        ├── dv_original/
        └── dvs_raw/
```

**重要说明**：
- 每个会话目录必须同时包含 `dv_original` 和 `dvs_raw`（或 `dvs_images`）文件夹
- DVS数据支持 `.raw` 和 `.bin` 格式文件
- 系统会递归搜索所有子目录
- 不符合要求的目录会被自动跳过

### 2. 启动递归播放

1. 点击主窗口中的 **"选择主目录递归播放"** 按钮
2. 在弹出的文件夹选择对话框中，选择包含所有会话数据的主目录
3. 点击"确定"后，系统开始自动搜索和播放

### 3. 监控播放进度

- **状态显示**：播放状态框会显示：
  - "播放状态: 开始 (共X个会话)" - 开始时显示总会话数
  - "播放状态: X/Y - 会话名称" - 播放过程中显示当前进度
  - "播放状态: 已完成" - 全部播放完成

- **图像显示**：
  - DV图像显示在左侧视图
  - DVS图像显示在右侧视图
  - 如果启用了检测功能，会显示带检测框的图像

### 4. 检测功能集成

如果启用了检测功能（勾选"启用检测功能"复选框）：

1. **自动检测**：播放过程中，每一帧DV和DVS图像都会自动送入检测模块
2. **结果显示**：
   - DV检测结果显示在"DV检测结果"标签
   - DVS检测结果显示在"DVS检测结果"标签
   - 最终判决显示在"最终判决"标签
3. **结果保存**：检测结果会自动保存到 `detection_results.txt` 文件

### 5. 停止播放

- 递归播放过程中，播放按钮会被禁用防止重复点击
- 如需停止，可以关闭程序或等待播放完成
- 播放完成后，按钮会重新启用

## 注意事项

### 数据要求
- 确保每个会话目录都包含完整的DV和DVS数据
- DV图像文件应为常见格式（jpg、png、bmp等）
- DVS文件应为.raw或.bin格式

### 性能考虑
- 大量会话数据可能需要较长时间播放
- 建议在播放前检查磁盘空间和系统性能
- 检测功能会增加CPU使用率

### 错误处理
- 无效的会话目录会被自动跳过
- 如果某个会话播放失败，系统会继续播放下一个
- 错误信息会在控制台输出

## 故障排除

### 问题：没有找到有效会话
**解决方案**：
- 检查目录结构是否正确
- 确保每个会话目录都包含dv_original和dvs_raw/dvs_images
- 查看控制台输出的详细错误信息

### 问题：播放卡顿或停止
**解决方案**：
- 检查文件是否损坏
- 确保有足够的系统内存
- 关闭其他占用资源的程序

### 问题：检测功能不工作
**解决方案**：
- 确保已勾选"启用检测功能"
- 检查模型文件是否存在且正确
- 查看检测模块的错误信息

## 技术细节

- **支持格式**：DV图像（jpg、png、bmp），DVS数据（.raw、.bin）
- **播放速度**：约30fps（可在代码中调整）
- **内存管理**：使用智能指针确保内存安全
- **线程安全**：检测模块使用独立线程，避免UI阻塞
